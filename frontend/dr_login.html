<!DOCTYPE html>
<html>
<head>
    <title>Medical App</title>
    <style>
        body { font-family: Arial; background:#f4f6f7; margin:0; padding:0; }
        .container { max-width:700px; margin:30px auto; background:white; padding:25px; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
        h2 { text-align:center; color:#333; }
        input, select, textarea { width:100%; padding:10px; margin-top:5px; border-radius:5px; border:1px solid #ccc; box-sizing:border-box; }
        button { width:100%; padding:12px; margin-top:20px; border:none; border-radius:5px; background:#007BFF; color:#fff; font-size:16px; cursor:pointer; }
        button:hover { background:#0056b3; }
        table { width:100%; border-collapse:collapse; margin-top:20px; }
        table th, table td { padding:12px; border:1px solid #ddd; text-align:left; }
        table th { background:#007BFF; color:white; }
        table tr:nth-child(even) { background:#f9f9f9; }
        a { color:#007BFF; text-decoration:none; cursor:pointer; }
        a:hover { text-decoration:underline; }
        .hidden { display:none; }
        .status-accepted { color: green; font-weight: bold; }
        .status-rejected { color: red; font-weight: bold; }
        .status-pending { color: orange; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">

<!-- Doctor Login -->
<div id="loginSection">
    <h2>Doctor Login</h2>
    <input type="text" id="username" placeholder="Username" required><br>
    <input type="password" id="password" placeholder="Password" required><br>
    <button id="loginBtn">Login</button>
</div>

<!-- Dashboard -->
<div id="dashboardSection" class="hidden">
    <h2>Dashboard</h2>
    <button id="logoutBtn">Logout</button> |
    <button id="showAddPatient">Add Patient</button>
    <table id="patientsTable">
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Age</th>
            <th>Gender</th>
            <th>Status</th>
            <th>Action</th>
        </tr>
    </table>
</div>

<!-- Add Patient Form -->
<div id="addPatientSection" class="hidden">
    <h2>Add Patient</h2>
    <input type="text" id="pname" placeholder="Patient Name" required>
    <input type="number" id="page" placeholder="Age" required>
    <select id="pgender" required>
        <option value="">Select Gender</option>
        <option>Male</option><option>Female</option><option>Other</option>
    </select>
    <input type="text" id="pcontact" placeholder="Contact Number" required>
    <textarea id="paddress" placeholder="Address"></textarea>
    <textarea id="pmedical" placeholder="Medical History"></textarea>
    <textarea id="pallergies" placeholder="Allergies"></textarea>
    <textarea id="pmedications" placeholder="Current Medications"></textarea>
    <button id="addPatientBtn">Add Patient</button>
    <button id="backToDashboard">Back to Dashboard</button>
</div>

<!-- Appointment Section -->
<div id="appointmentSection" class="hidden">
    <h2 id="patientName"></h2>
    <p>Heart Rate: <span id="heartRate"></span> bpm</p>
    <p>Temperature: <span id="temperature"></span> °F</p>
    <p>SpO₂: <span id="spo2"></span> %</p>
    <p>GSR: <span id="gsr"></span> µS</p>
    <p>Status: <span id="appointmentStatus"></span></p>
    <button id="backToDashboardFromAppointment">Back to Dashboard</button>
</div>

</div>

<script>
    // -------------------- Login --------------------
    const loginSection = document.getElementById("loginSection");
    const dashboardSection = document.getElementById("dashboardSection");
    const addPatientSection = document.getElementById("addPatientSection");
    const appointmentSection = document.getElementById("appointmentSection");

    const loginBtn = document.getElementById("loginBtn");
    loginBtn.addEventListener("click", function() {
        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;
        if(username === "doctor" && password === "1234"){
            localStorage.setItem("isLoggedIn", "true");
            showDashboard();
        } else {
            alert("Invalid credentials!");
        }
    });

    function checkLogin() {
        if(localStorage.getItem("isLoggedIn") === "true") showDashboard();
    }
    checkLogin();

    // -------------------- Logout --------------------
    document.getElementById("logoutBtn").addEventListener("click", function(){
        localStorage.removeItem("isLoggedIn");
        loginSection.classList.remove("hidden");
        dashboardSection.classList.add("hidden");
    });

    // -------------------- Show Dashboard --------------------
    function showDashboard(){
        loginSection.classList.add("hidden");
        addPatientSection.classList.add("hidden");
        appointmentSection.classList.add("hidden");
        dashboardSection.classList.remove("hidden");
        renderPatientsTable();
    }

    // -------------------- Show Add Patient --------------------
    document.getElementById("showAddPatient").addEventListener("click", function(){
        dashboardSection.classList.add("hidden");
        addPatientSection.classList.remove("hidden");
    });

    document.getElementById("backToDashboard").addEventListener("click", showDashboard);

    // -------------------- Add Patient --------------------
    document.getElementById("addPatientBtn").addEventListener("click", function(){
        let patients = JSON.parse(localStorage.getItem("patients") || "[]");
        const patient = {
            id: patients.length + 1,
            name: document.getElementById("pname").value,
            age: document.getElementById("page").value,
            gender: document.getElementById("pgender").value,
            contact: document.getElementById("pcontact").value,
            address: document.getElementById("paddress").value,
            medical_history: document.getElementById("pmedical").value,
            allergies: document.getElementById("pallergies").value,
            medications: document.getElementById("pmedications").value,
            status: "Pending"
        };
        patients.push(patient);
        localStorage.setItem("patients", JSON.stringify(patients));
        alert("Patient added!");
        document.getElementById("pname").value = "";
        document.getElementById("page").value = "";
        document.getElementById("pgender").value = "";
        document.getElementById("pcontact").value = "";
        document.getElementById("paddress").value = "";
        document.getElementById("pmedical").value = "";
        document.getElementById("pallergies").value = "";
        document.getElementById("pmedications").value = "";
        showDashboard();
    });

    // -------------------- Render Patients Table --------------------
    function renderPatientsTable(){
        const table = document.getElementById("patientsTable");
        // remove old rows except header
        table.querySelectorAll("tr:not(:first-child)").forEach(r => r.remove());
        let patients = JSON.parse(localStorage.getItem("patients") || "[]");
        patients.forEach((p,index) => {
            let row = table.insertRow();
            row.insertCell(0).innerText = p.id;
            row.insertCell(1).innerText = p.name;
            row.insertCell(2).innerText = p.age;
            row.insertCell(3).innerText = p.gender;
            const statusCell = row.insertCell(4);
            statusCell.innerText = p.status;
            if(p.status==="Accepted") statusCell.className="status-accepted";
            else if(p.status==="Rejected") statusCell.className="status-rejected";
            else statusCell.className="status-pending";
            row.insertCell(5).innerHTML = `
                <a onclick="viewAppointment(${p.id})">View</a> |
                <button onclick="updateStatus(${index},'Accepted')">Accept</button>
                <button onclick="updateStatus(${index},'Rejected')">Reject</button>
            `;
        });
    }

    function updateStatus(index,newStatus){
        let patients = JSON.parse(localStorage.getItem("patients") || "[]");
        patients[index].status = newStatus;
        localStorage.setItem("patients", JSON.stringify(patients));
        renderPatientsTable();
    }

    // -------------------- View Appointment --------------------
    function viewAppointment(id){
        const patient = JSON.parse(localStorage.getItem("patients")||"[]").find(p=>p.id===id);
        if(!patient) return;
        dashboardSection.classList.add("hidden");
        addPatientSection.classList.add("hidden");
        appointmentSection.classList.remove("hidden");

        document.getElementById("patientName").innerText = "Appointment for " + patient.name;
        const statusEl = document.getElementById("appointmentStatus");
        statusEl.innerText = patient.status;
        statusEl.style.color = patient.status==="Accepted"?"green":patient.status==="Rejected"?"red":"orange";

        function updateVitals(){
            document.getElementById("heartRate").innerText = Math.floor(Math.random()*40+60);
            document.getElementById("temperature").innerText = (Math.random()*2+97).toFixed(1);
            document.getElementById("spo2").innerText = Math.floor(Math.random()*6+95);
            document.getElementById("gsr").innerText = (Math.random()*1.5+0.5).toFixed(2);
        }
        updateVitals();
        // update every 2 seconds
        if(window.vitalsInterval) clearInterval(window.vitalsInterval);
        window.vitalsInterval = setInterval(updateVitals,2000);
    }

    document.getElementById("backToDashboardFromAppointment").addEventListener("click", showDashboard);

</script>

</body>
</html>
